(()=>{"use strict";var t=document.querySelector(".profile__button-edit"),e=document.querySelector(".profile__button-avatar"),n=document.querySelector(".profile__button-add"),r=document.querySelector(".profile__name"),o=document.querySelector(".profile__status"),i=document.querySelector(".profile__avatar"),u=".popup_avatar",a=document.querySelector(u).querySelector("form"),s="#popup-edit",c=document.querySelector(s).querySelector("form"),l="#popup-add",f=document.querySelector(l).querySelector("form"),p={};function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._baseUrl=e.baseUrl,this._token=e.headers.authorization,this._headers=e.headers}var e,n;return e=t,(n=[{key:"_getMethod",value:function(t){return fetch("".concat(this._baseUrl).concat(t),{headers:{authorization:this._token}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"_PatchPostMethod",value:function(t,e,n){return fetch("".concat(this._baseUrl).concat(t),{method:e,headers:this._headers,body:JSON.stringify(n)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getUserInfo",value:function(){return this._getMethod("/users/me")}},{key:"getCardsArray",value:function(){return this._getMethod("/cards")}},{key:"patchUserAvatar",value:function(t){return this._PatchPostMethod("/users/me/avatar","PATCH",t)}},{key:"patchUserInfo",value:function(t){return this._PatchPostMethod("/users/me","PATCH",t)}},{key:"postCardData",value:function(t){return this._PatchPostMethod("/cards","POST",t)}},{key:"deleteCard",value:function(t){return this._PatchPostMethod("/cards/".concat(t),"DELETE",{})}},{key:"setLike",value:function(t){return this._PatchPostMethod("/cards/".concat(t,"/likes"),"PUT",{})}},{key:"deleteLike",value:function(t){return this._PatchPostMethod("/cards/".concat(t,"/likes"),"DELETE",{})}}])&&h(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var d=function(){function t(e,n,r,o,i,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e.name,this._link=e.link,this._id=e._id,this._likesArray=e.likes,this._likesCounter=e.likes.length,this._curentUserId=o,this._like=!1,this._cardSelector=n,this._handleCardClick=r,this._isCurentUserCard=this._curentUserId===e.owner._id,this._handleDeleteCardButton=i,this._handleLikeButton=u}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}},{key:"generationCard",value:function(){return this._element=this._getTemplate(),this._photoCard=this._element.querySelector(".element__photo"),this._cardLike=this._element.querySelector(".element__vector"),this._cardTrash=this._element.querySelector(".element__trash"),this._cardTitle=this._element.querySelector(".element__title"),this._cardLikesCounter=this._element.querySelector(".element__vector-counter"),this.updateLikeState(this._likesArray),this._isCurentUserCard||this._cardTrash.remove(),this._element.id=this._id,this._photoCard.src=this._link,this._photoCard.alt=this._name,this._cardTitle.textContent=this._name,this._setEventListeners(),this._element}},{key:"_setEventListeners",value:function(){var t=this;this._photoCard.addEventListener("click",(function(){t._handleCardClick(t._link,t._name)})),this._cardLike.addEventListener("click",(function(){t._handleLikeButton(t)})),this._isCurentUserCard&&this._cardTrash.addEventListener("click",(function(){t._handleDeleteCardButton(t)}))}},{key:"updateLikeState",value:function(t){var e=this;this._likesArray=t,this._likesCounter=t.length,this._cardLikesCounter.textContent=this._likesCounter,this._likesArray.some((function(t){return t._id===e._curentUserId}))!==this._like&&this._toggleLikeCard()}},{key:"deleteElementCard",value:function(){this._element.remove(),this._element=null}},{key:"_toggleLikeCard",value:function(){this._cardLike.classList.toggle("element__vector_active"),this._like=!this._like}}])&&y(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,"_showInputError",(function(t){var e=r._formElement.querySelector("#error-".concat(t.id));t.classList.add(r._inputErrorClass),e.textContent=t.validationMessage,e.classList.add(r._errorClass)})),m(this,"_hideInputError",(function(t){var e=r._formElement.querySelector("#error-".concat(t.id));t.classList.remove(r._inputErrorClass),e.classList.remove(r._errorClass),e.textContent=""})),m(this,"_checkInputValidity",(function(t){t.validity.valid?r._hideInputError(t):r._showInputError(t)})),m(this,"_hasInvalidInput",(function(){return r._inputList.some((function(t){return!t.validity.valid}))})),m(this,"enableValidation",(function(){r._setEventListeners()})),m(this,"resetError",(function(){r._inputList.forEach((function(t){r._hideInputError(t)})),r.toggleButtonState()})),this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=n,this._buttonElement=this._formElement.querySelector(this._submitButtonSelector),this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector))}var e,n;return e=t,(n=[{key:"_enableSubmitButton",value:function(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled")}},{key:"_disableSubmitButton",value:function(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}},{key:"toggleButtonState",value:function(){this._hasInvalidInput()?this._disableSubmitButton():this._enableSubmitButton()}},{key:"_setEventListeners",value:function(){var t=this;this.toggleButtonState(),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t.toggleButtonState()}))}))}}])&&v(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var g=function(){function t(e,n){var r=e.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._renderer=r,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.prepend(t)}},{key:"renderItems",value:function(t){var e=this;t.forEach((function(t){e._renderer(t)}))}},{key:"reverseRenderItems",value:function(t){for(var e=t.length-1;e>=0;--e)this._renderer(t[e])}}])&&k(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popup=document.querySelector(e),this._buttonClose=this._popup.querySelector(".popup__close"),this._closePopup=this._handleEscClose.bind(this)}var e,n;return e=t,(n=[{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"open",value:function(){document.addEventListener("keydown",this._closePopup),this._popup.classList.add("popup_opened")}},{key:"close",value:function(){document.removeEventListener("keydown",this._closePopup),this._popup.classList.remove("popup_opened")}},{key:"setEventListeners",value:function(){var t=this;this._popup.addEventListener("mousedown",(function(e){e.target===e.currentTarget&&t.close(e.currentTarget)})),this._buttonClose.addEventListener("click",this.close.bind(this))}}])&&E(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(){return O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=P(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},O.apply(this,arguments)}function P(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=B(t)););return t}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}function j(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},B(t)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(r);if(o){var n=B(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return j(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._submitButton=n._popup.querySelector(".popup__submit-btn"),n._handleSubmit=e,n}return e=u,(n=[{key:"setButtonText",value:function(t){this._submitButton.textContent=t}},{key:"setEventListeners",value:function(){var t=this;O(B(u.prototype),"setEventListeners",this).call(this),this._submitButton.addEventListener("click",(function(){t._handleSubmit()}))}}])&&C(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(w);function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function R(){return R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=x(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},R.apply(this,arguments)}function x(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function U(t,e){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},U(t,e)}function A(t,e){if(e&&("object"===I(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&U(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(o){var n=D(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return A(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=i.call(this,t))._popupImage=e._popup.querySelector(".popup__image"),e._popupTitle=e._popup.querySelector(".popup__name"),e}return e=u,(n=[{key:"open",value:function(t){var e=t.link,n=t.name;this._popupImage.src=e,this._popupImage.alt=n,this._popupTitle.textContent=n,R(D(u.prototype),"open",this).call(this)}}])&&q(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(w);function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(){return F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=J(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},F.apply(this,arguments)}function J(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}function z(t,e){if(e&&("object"===M(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function G(t){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},G(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(u,t);var e,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=G(r);if(o){var n=G(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return z(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=i.call(this,t))._form=n._popup.querySelector(".form"),n._submitButton=n._form.querySelector(".popup__submit-btn"),n._inputList=Array.from(n._form.querySelectorAll(".form__input")),n._submitFormHandler=e,n}return e=u,(n=[{key:"_getInputValues",value:function(){var t=this;return this._inputsValue={},this._inputList.forEach((function(e){t._inputsValue[e.name]=e.value})),this._inputsValue}},{key:"setInputValues",value:function(t,e){this._inputList.forEach((function(n){n.name===t&&(n.value=e)}))}},{key:"setButtonText",value:function(t){this._submitButton.textContent=t}},{key:"setEventListeners",value:function(){var t=this;F(G(u.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t._submitFormHandler(t._getInputValues())}))}},{key:"close",value:function(){F(G(u.prototype),"close",this).call(this),this._form.reset()}}])&&N(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(w);function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var W=function(){function t(e){var n=e.userName,r=e.userJob,o=e.userAvatar;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._userName=n,this._userJob=r,this._userAvatar=o}var e,n;return e=t,(n=[{key:"setUserData",value:function(t){var e=t.name,n=t.about,r=t.avatar,o=t._id;this._userName.textContent=e,this._userJob.textContent=n,this._userAvatar.src=r,this._id=o}},{key:"getUserId",value:function(){return this._id}},{key:"getUserInfo",value:function(){return{name:this._userName.textContent,status:this._userJob.textContent}}}])&&Q(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function X(t,e){rt.open({link:t,name:e})}function Y(t){return new d(t,"#elements__template",X,ut.getUserId(),Z,$).generationCard()}function Z(t){st.cardForDelete=t,st.open()}function $(t){t._like?et.deleteLike(t._id).then((function(e){t.updateLikeState(e.likes)})).catch((function(t){alert(t)})):et.setLike(t._id).then((function(e){t.updateLikeState(e.likes)})).catch((function(t){alert(t)}))}var tt,et=new _({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-44",headers:{authorization:"9d5eb0d3-fb55-4a88-9fe1-f4f0f3428bab","Content-Type":"application/json"}}),nt=new g({renderer:function(t){var e=Y(t);nt.addItem(e)}},".elements");tt={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__set"},Array.from(document.querySelectorAll(tt.formSelector)).forEach((function(t){var e=new b(tt,t);p[t.name]=e,e.enableValidation()}));var rt=new V(".popup_images");rt.setEventListeners();var ot=new K(s,(function(t){var e=t.form_name,n=t.form_status;ot.setButtonText("Сохранение..."),et.patchUserInfo({name:e,about:n}).then((function(t){ut.setUserData(t),ot.close()})).catch((function(t){alert(t)})).finally((function(){ot.setButtonText("Сохранить")})),p[c.name].toggleButtonState()}));ot.setEventListeners();var it=new K(l,(function(t){var e=t.form_place,n=t.form_link;it.setButtonText("Сохранение..."),et.postCardData({name:e,link:n}).then((function(t){var e=Y(t);nt.addItem(e),it.close()})).catch((function(t){alert(t)})).finally((function(){it.setButtonText("Создать")}))}));it.setEventListeners();var ut=new W({userName:r,userJob:o,userAvatar:i}),at=new K(u,(function(t){var e=t.form_avatar;at.setButtonText("Сохранение..."),et.patchUserAvatar({avatar:e}).then((function(t){ut.setUserData(t),at.close()})).catch((function(t){alert(t)})).finally((function(){at.setButtonText("Сохранить")})),p[a.name].toggleButtonState()}));at.setEventListeners();var st=new T(".popup_delete",(function(){st.setButtonText("Удаление..."),et.deleteCard(st.cardForDelete._id).then((function(){st.cardForDelete.deleteElementCard(),st.close(),st.cardForDelete={}})).catch((function(t){alert(t)})).finally((function(){st.setButtonText("Да")}))}));st.setEventListeners(),n.addEventListener("click",(function(){p[f.name].resetError(),it.open()})),t.addEventListener("click",(function(){var t=ut.getUserInfo();ot.setInputValues("form_name",t.name),ot.setInputValues("form_status",t.status),p[c.name].resetError(),ot.open()})),e.addEventListener("click",(function(){p[a.name].resetError(),at.open()})),Promise.all([et.getUserInfo(),et.getCardsArray()]).then((function(t){ut.setUserData(t[0]),nt.reverseRenderItems(t[1])})).catch((function(t){alert(t)}))})();